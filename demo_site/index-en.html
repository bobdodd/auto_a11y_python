<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quebec Insurance Plus - Home</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <!-- Header with navigation -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="images/quebec-logo.svg" alt="">
                    <span class="site-name">Quebec Insurance Plus</span>
                </div>

                <!-- Language switcher - buried deep in tab order -->
            </div>

            <!-- Navigation with inappropriate menu role -->
            <nav role="menu" aria-label="Main navigation">
                <ul>
                    <li><a href="index-en.html">Home</a></li>
                    <li><a href="services-en.html">Services</a></li>
                    <li><a href="#" aria-haspopup="true">Resources</a></li>
                    <li><a href="#">Contact</a></li>
                    <li><a href="login-en.html" class="login-link">Login</a></li>
                    <li class="language-switch">
                        <a href="index.html">FR</a>
                        <a href="index-en.html">EN</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main content -->
    <main>
        <h1 id="main-content" class="visually-hidden" tabindex="-1">Welcome to Quebec Insurance Plus</h1>

        <!-- Hero carousel with auto-play and no controls -->
        <div class="hero-carousel" id="carousel">
            <div class="carousel-item active">
                <img src="images/hero1.svg" alt="Digital services for all citizens">
                <div class="carousel-caption">
                    <h2>Accessible Digital Services</h2>
                    <p>We're committed to digital excellence and accessibility for all citizens.</p>
                </div>
            </div>
            <div class="carousel-item">
                <img src="images/hero2.svg" alt="Innovation and technology">
                <div class="carousel-caption">
                    <h2>Innovation and Technology</h2>
                    <p>Leading the way in digital transformation.</p>
                </div>
            </div>
            <div class="carousel-item">
                <img src="images/hero3.svg" alt="Online services">
                <div class="carousel-caption">
                    <h2>Online Services</h2>
                    <p>Access government services 24/7 from anywhere.</p>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Loading spinner without screen reader announcement -->
            <div class="loading-section">
                <div class="spinner" aria-hidden="true"></div>
                <p>Loading services...</p>
            </div>

            <!-- Services section -->
            <section class="services-section">
                <!-- This should be h2 but using div with styling instead -->
                <div class="fake-heading">Our Main Services</div>

                <div class="services-grid">
                    <div class="service-card">
                        <img src="images/service1.svg" alt="Online services">
                        <div class="fake-heading-small">Online Services</div>
                        <p>Access your government services online and manage your account.</p>
                        <a href="#" class="btn-primary">Learn more</a>
                    </div>

                    <div class="service-card">
                        <img src="images/service2.svg" alt="Documentation">
                        <div class="fake-heading-small">Documentation and Guides</div>
                        <p>Download important guides and documents for your needs.</p>
                        <a href="pdfs/guide-services-en.pdf" class="btn-primary">Download guide (PDF)</a>
                    </div>

                    <div class="service-card">
                        <img src="images/service3.svg" alt="Support">
                        <div class="fake-heading-small">Help Center</div>
                        <p>Our team is available to assist you with any questions.</p>
                        <a href="#" class="btn-primary">Contact support</a>
                    </div>
                </div>
            </section>

            <!-- Interactive map hidden with aria-hidden -->
            <section class="map-section">
                <h2>Find a Service Office</h2>
                <p>Locate the government office closest to your location.</p>

                <!-- Map hidden with aria-hidden but still keyboard focusable -->
                <div class="map-container" aria-hidden="true">
                    <iframe
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2795.926340251352!2d-73.56850268444144!3d45.50866797910156!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4cc91a56830b0d47%3A0xbb8000d663ab0e07!2sQuebec%20City%2C%20QC%2C%20Canada!5e0!3m2!1sen!2sus!4v1639000000000!5m2!1sen!2sus"
                        width="100%"
                        height="400"
                        style="border:0;"
                        allowfullscreen=""
                        loading="lazy">
                    </iframe>
                    <div class="map-controls">
                        <button>Zoom +</button>
                        <button>Zoom -</button>
                        <button>My location</button>
                    </div>
                </div>
            </section>

            <!-- Desktop-only sidebar with color contrast issue -->
            <aside class="desktop-only-sidebar">
                <div class="fake-heading-small">Quick Access</div>
                <ul class="sidebar-links">
                    <li><a href="#" style="color: #999; background: #ddd;">Online forms</a></li>
                    <li><a href="#" style="color: #999; background: #ddd;">My file</a></li>
                    <li><a href="#" style="color: #999; background: #ddd;">Payments</a></li>
                    <li class="language-switch">
                        <a href="index.html">FR</a>
                        <a href="index-en.html">EN</a>
                    </li>
                </ul>
            </aside>

            <!-- Toolbar with icon button without accessible name -->
            <div class="toolbar">
                <button class="icon-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24">
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </button>
                <button class="icon-btn" aria-label="Search">
                    <svg width="24" height="24" viewBox="0 0 24 24">
                        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                </button>
                <button class="icon-btn" aria-label="Print">
                    <svg width="24" height="24" viewBox="0 0 24 24">
                        <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                    </svg>
                </button>
            </div>

            <!-- Newsletter subscribe section -->
            <section class="newsletter-section">
                <h2>Stay Informed</h2>
                <p>Subscribe to our newsletter to receive insurance tips and exclusive offers.</p>
                <button id="open-newsletter-modal" class="btn-primary">Subscribe to Newsletter</button>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="fake-heading-small">About</div>
                    <ul>
                        <li><a href="#">Mission</a></li>
                        <li><a href="#">Team</a></li>
                        <li><a href="#">Careers</a></li>
                        <li class="language-switch">
                        <a href="index.html">FR</a>
                        <a href="index-en.html">EN</a>
                    </li>
                </ul>
                </div>
                <div class="footer-section">
                    <div class="fake-heading-small">Services</div>
                    <ul>
                        <li><a href="#">For citizens</a></li>
                        <li><a href="#">For businesses</a></li>
                        <li><a href="#">For municipalities</a></li>
                        <li class="language-switch">
                        <a href="index.html">FR</a>
                        <a href="index-en.html">EN</a>
                    </li>
                </ul>
                </div>
                <div class="footer-section">
                    <div class="fake-heading-small">Contact</div>
                    <ul>
                        <li><a href="#">Technical support</a></li>
                        <li><a href="#">Regional offices</a></li>
                        <li><a href="#">Emergency</a></li>
                        <li class="language-switch">
                        <a href="index.html">FR</a>
                        <a href="index-en.html">EN</a>
                    </li>
                </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Assurance Qu√©bec Plus. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Newsletter Modal (accessible but fails to return focus when closed) -->
    <div id="newsletter-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description" hidden>
        <div class="modal-overlay" aria-hidden="true"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Subscribe to Our Newsletter</h2>
                <button id="close-modal" class="modal-close" aria-label="Close dialog">
                    <svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p id="modal-description">Receive our latest news, insurance tips and exclusive offers directly in your inbox.</p>
                <form id="newsletter-form" class="newsletter-form">
                    <div class="form-group">
                        <label for="newsletter-name">Full Name</label>
                        <input type="text" id="newsletter-name" name="name" required aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="newsletter-email">Email Address</label>
                        <input type="email" id="newsletter-email" name="email" required aria-required="true">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="newsletter-consent" name="consent" required aria-required="true">
                            I agree to receive marketing communications
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Subscribe</button>
                        <button type="button" id="cancel-modal" class="btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Cookie notice (intentional issue: placed at end of DOM but visually at bottom) -->
    <div id="cookie-notice" class="cookie-notice">
        <p>We use cookies to improve your experience. By continuing, you accept our use of cookies.</p>
        <button id="cookie-accept" class="btn-primary">OK</button>
    </div>

    <script src="js/carousel.js"></script>
    <script src="js/spinner.js"></script>
    <script>
        // Cookie notice functionality
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        if (!getCookie('cookieAccepted')) {
            document.getElementById('cookie-notice').style.display = 'flex';
        }
        document.getElementById('cookie-accept').addEventListener('click', function() {
            setCookie('cookieAccepted', 'true', 365);
            document.getElementById('cookie-notice').style.display = 'none';
        });

        // Newsletter Modal functionality (accessible but fails to restore focus)
        const modal = document.getElementById('newsletter-modal');
        const openModalBtn = document.getElementById('open-newsletter-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const cancelModalBtn = document.getElementById('cancel-modal');
        const newsletterForm = document.getElementById('newsletter-form');

        // Store focusable elements for keyboard trap
        let focusableElements = [];
        let firstFocusableElement = null;
        let lastFocusableElement = null;

        function openModal() {
            modal.hidden = false;
            document.body.style.overflow = 'hidden';

            // Get all focusable elements within the modal
            focusableElements = Array.from(modal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            )).filter(el => !el.disabled && el.offsetParent !== null);

            firstFocusableElement = focusableElements[0];
            lastFocusableElement = focusableElements[focusableElements.length - 1];

            // Move focus to first element (close button)
            if (firstFocusableElement) {
                firstFocusableElement.focus();
            }
        }

        function closeModal() {
            modal.hidden = true;
            document.body.style.overflow = '';
            newsletterForm.reset();

            // INTENTIONAL ACCESSIBILITY ISSUE:
            // NOT returning focus to the trigger button
            // Proper implementation would be: openModalBtn.focus();
            // This creates a keyboard navigation issue where focus is lost
        }

        // Keyboard trap - keeps focus inside modal
        function handleKeyDown(e) {
            if (!modal.hidden) {
                // Handle Escape key
                if (e.key === 'Escape') {
                    closeModal();
                    return;
                }

                // Handle Tab key for focus trap
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        // Shift+Tab - moving backwards
                        if (document.activeElement === firstFocusableElement) {
                            e.preventDefault();
                            lastFocusableElement.focus();
                        }
                    } else {
                        // Tab - moving forwards
                        if (document.activeElement === lastFocusableElement) {
                            e.preventDefault();
                            firstFocusableElement.focus();
                        }
                    }
                }
            }
        }

        // Event listeners
        openModalBtn.addEventListener('click', openModal);
        closeModalBtn.addEventListener('click', closeModal);
        cancelModalBtn.addEventListener('click', closeModal);
        document.addEventListener('keydown', handleKeyDown);

        // Close on overlay click
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeModal();
            }
        });

        // Handle form submission
        newsletterForm.addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Thank you for subscribing! (This is a demo)');
            closeModal();
        });
    </script>
</body>
</html>
