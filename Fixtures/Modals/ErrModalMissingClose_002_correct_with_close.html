<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ErrModalMissingClose - Correct Usage</title>
    <script type="application/json" id="test-metadata">
{
    "id": "ErrModalMissingClose_002_correct_with_close",
    "issueId": "ErrModalMissingClose",
    "expectedViolationCount": 0,
    "expectedPassCount": 1,
    "description": "Modal dialog with accessible close button",
    "wcag": "2.1.1",
    "impact": "High"
}
    </script>
    <style>
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal.open {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: 2px solid #333;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-button:hover {
            background: #f0f0f0;
        }

        .close-button:focus {
            outline: 3px solid #007bff;
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <h1>Newsletter Signup</h1>

    <main>
        <section>
            <h2>Stay Updated</h2>
            <p>Subscribe to our newsletter for the latest updates and special offers.</p>
            <button id="openModal">Subscribe Now</button>
        </section>
    </main>

    <!-- Modal with close button - CORRECT -->
    <div id="subscribeModal"
         class="modal"
         role="dialog"
         aria-labelledby="modalTitle"
         aria-modal="true"
         data-expected-pass="true"
         data-pass-reason="Modal dialog has accessible close button in top right. Users can dismiss modal without submitting form. Close button is keyboard accessible with visible focus indicator. Screen readers announce 'Close dialog' button. Users who change mind or accidentally opened modal can easily exit. Escape key also closes modal. Complies with WCAG 2.1.1 Keyboard and 2.1.2 No Keyboard Trap by providing accessible exit method">
        <div class="modal-content">
            <button class="close-button"
                    id="closeModal"
                    aria-label="Close dialog">
                ×
            </button>

            <h2 id="modalTitle">Subscribe to Our Newsletter</h2>
            <p>Get exclusive updates, offers, and news delivered to your inbox.</p>

            <form>
                <div>
                    <label for="modalEmail">Email Address:</label>
                    <input type="email" id="modalEmail" name="email" required>
                </div>

                <div>
                    <label>
                        <input type="checkbox" name="terms" required>
                        I agree to receive marketing emails
                    </label>
                </div>

                <div>
                    <button type="submit">Subscribe</button>
                    <button type="button" id="cancelButton">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Modal open/close logic (for demonstration)
        const modal = document.getElementById('subscribeModal');
        const openBtn = document.getElementById('openModal');
        const closeBtn = document.getElementById('closeModal');
        const cancelBtn = document.getElementById('cancelButton');

        function openModal() {
            modal.classList.add('open');
            closeBtn.focus();
        }

        function closeModal() {
            modal.classList.remove('open');
            openBtn.focus();
        }

        openBtn.addEventListener('click', openModal);
        closeBtn.addEventListener('click', closeModal);
        cancelBtn.addEventListener('click', closeModal);

        // Escape key closes modal
        modal.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Clicking backdrop closes modal
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });
    </script>

    <footer>
        <p>&copy; 2024 Newsletter Service. All rights reserved.</p>
    </footer>
</body>
</html>
