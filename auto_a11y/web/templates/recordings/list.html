{% extends "base.html" %}

{% block title %}{{ _('Recordings') }} - Auto A11y{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center mb-4 gap-2">
        <h1 class="h2 mb-0">
            <i class="bi bi-mic"></i> {{ _('Recordings') }}
        </h1>
        <a href="{{ url_for('recordings.upload_recording') }}" class="btn btn-primary w-100 w-sm-auto">
            <i class="bi bi-upload"></i> {{ _('Upload Recording') }}
        </a>
    </div>

    <p class="text-muted d-none d-md-block">
        {{ _('Manual audit recordings from Dictaphone and expert reviews. These complement automated test results with human observations and lived experience findings.') }}
    </p>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body py-2 py-md-3">
            <form method="get" action="{{ url_for('recordings.list_recordings') }}" class="row g-2 g-md-3">
                <div class="col-6 col-md-6">
                    <label for="project_id" class="form-label small">{{ _('Project') }}</label>
                    <select name="project_id" id="project_id" class="form-select form-select-sm" onchange="this.form.submit()">
                        <option value="">{{ _('All Projects') }}</option>
                        {% for project in projects %}
                        <option value="{{ project.id }}" {{ 'selected' if selected_project_id == project.id }}>
                            {{ project.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-6 col-md-6">
                    <label for="recording_type" class="form-label small">{{ _('Type') }}</label>
                    <select name="recording_type" id="recording_type" class="form-select form-select-sm" onchange="this.form.submit()">
                        <option value="">{{ _('All Types') }}</option>
                        <option value="audit" {{ 'selected' if selected_recording_type == 'audit' }}>{{ _('Audit') }}</option>
                        <option value="lived_experience_website" {{ 'selected' if selected_recording_type == 'lived_experience_website' }}>{{ _('Lived Exp. Website') }}</option>
                        <option value="lived_experience_app" {{ 'selected' if selected_recording_type == 'lived_experience_app' }}>{{ _('Lived Exp. App') }}</option>
                        <option value="lived_experience_tangible_device" {{ 'selected' if selected_recording_type == 'lived_experience_tangible_device' }}>{{ _('Lived Exp. Device') }}</option>
                        <option value="lived_experience_nav_and_wayfinding" {{ 'selected' if selected_recording_type == 'lived_experience_nav_and_wayfinding' }}>{{ _('Lived Exp. Nav') }}</option>
                    </select>
                </div>
            </form>
        </div>
    </div>

    {% if recordings %}
    <div class="row">
        {% for recording in recordings %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title">{{ recording.title }}</h5>
                        <div>
                            <span class="badge bg-info">{{ recording.recording_type.value|replace('_', ' ')|title }}</span>
                        </div>
                    </div>

                    <h6 class="text-muted mb-3">
                        <i class="bi bi-file-earmark-text"></i> {{ recording.recording_id }}
                        {% if recording.available_languages %}
                        <span class="ms-2">
                            {% for lang in recording.available_languages %}
                                {% if lang == 'en' %}
                                <span class="badge bg-secondary">EN</span>
                                {% elif lang == 'fr' %}
                                <span class="badge bg-secondary">FR</span>
                                {% endif %}
                            {% endfor %}
                        </span>
                        {% endif %}
                    </h6>

                    {% if recording.auditor_name %}
                    <p class="mb-2">
                        <i class="bi bi-person"></i> {{ recording.auditor_name }}
                        {% if recording.auditor_role %}
                        <span class="text-muted">({{ recording.auditor_role }})</span>
                        {% endif %}
                    </p>
                    {% endif %}

                    {% if recording.test_user_account %}
                    <p class="mb-2">
                        <i class="bi bi-person-circle"></i> {{ _('Test Account') }}: {{ recording.test_user_account }}
                    </p>
                    {% endif %}

                    {% if recording.recorded_date %}
                    <p class="mb-2">
                        <i class="bi bi-calendar"></i> {{ recording.recorded_date.strftime('%Y-%m-%d') }}
                    </p>
                    {% endif %}

                    {% if recording.duration %}
                    <p class="mb-3">
                        <i class="bi bi-clock"></i> {{ recording.duration }}
                    </p>
                    {% endif %}

                    <div class="mb-3">
                        <strong>{{ _('Issues') }}: {{ recording.total_issues }}</strong>
                        <div class="mt-1">
                            {% if recording.high_impact_count > 0 %}
                            <span class="badge bg-danger">{{ recording.high_impact_count }} {{ _('High') }}</span>
                            {% endif %}
                            {% if recording.medium_impact_count > 0 %}
                            <span class="badge bg-warning text-dark">{{ recording.medium_impact_count }} {{ _('Medium') }}</span>
                            {% endif %}
                            {% if recording.low_impact_count > 0 %}
                            <span class="badge bg-secondary">{{ recording.low_impact_count }} {{ _('Low') }}</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                        <a href="{{ url_for('recordings.view_recording', recording_id=recording.id) }}"
                           class="btn btn-sm btn-primary flex-grow-1">
                            <i class="bi bi-eye"></i> {{ _('View Details') }}
                        </a>
                        <form method="post" action="{{ url_for('recordings.delete_recording', recording_id=recording.id) }}"
                              onsubmit="return confirm('{{ _('Are you sure you want to delete this recording?') }}')" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> {{ _('No recordings found.') }}
        <a href="{{ url_for('recordings.upload_recording') }}">{{ _('Upload your first recording') }}</a> {{ _('to get started.') }}
    </div>
    {% endif %}
</div>
{% endblock %}
